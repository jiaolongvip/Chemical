<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chemical Work Record - Go Swim</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            touch-action: manipulation;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            margin: 10px 0;
        }
        
        header {
            background: #3498db;
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
        }
        
        .date-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .date-label {
            font-size: 16px;
            font-weight: 500;
        }
        
        .date-picker {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            color: #2c3e50;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 22px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .table-container {
            overflow-x: auto;
            padding: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
            font-size: 14px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: center;
            min-width: 70px;
        }
        
        th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            font-size: 13px;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .clickable-cell {
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            background-color: #e8f4ff;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .clickable-cell:hover, .clickable-cell:active {
            background-color: #cce6ff;
        }
        
        .cell-max {
            background-color: #ffcccc !important;
        }
        
        .total-row {
            background-color: #2ecc71;
            color: white;
            font-weight: bold;
        }
        
        .total-row td {
            border-top: 2px solid #27ae60;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 140px;
            min-height: 44px;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-reset {
            background: #e74c3c;
        }
        
        .btn-export {
            background: #f39c12;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px;
            border-left: 4px solid #3498db;
            font-size: 14px;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .instructions ul {
            padding-left: 18px;
        }
        
        .instructions li {
            margin-bottom: 6px;
            line-height: 1.4;
        }
        
        footer {
            text-align: center;
            padding: 12px;
            color: #7f8c8d;
            font-size: 12px;
        }
        
        /* Mobile-specific styles */
        @media (max-width: 480px) {
            th, td {
                padding: 8px 5px;
                min-width: 60px;
                font-size: 12px;
            }
            
            h1 {
                font-size: 20px;
            }
            
            .btn {
                min-width: 120px;
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .instructions {
                padding: 12px;
                margin: 10px;
            }
            
            .date-container {
                flex-direction: column;
            }
            
            .date-label {
                font-size: 14px;
            }
            
            .date-picker {
                width: 160px;
            }
        }
        
        /* Prevent iOS zoom */
        input, textarea, select {
            font-size: 16px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="date-container">
                <span class="date-label">Select Date:</span>
                <input type="date" id="date-picker" class="date-picker">
            </div>
            <h1>Chemical Work Record</h1>
            <div class="subtitle">Go Swim Data Recording System</div>
        </header>
        
        <div class="table-container">
            <table id="data-table">
                <thead>
                    <tr>
                        <th>Work Item</th>
                        <th>Acid</th>
                        <th>Salt</th>
                        <th>Cal+</th>
                        <th>Cal-</th>
                        <th>Protec</th>
                        <th>Banish</th>
                        <th>Powercide</th>
                        <th>Buffer</th>
                        <th>Chlorine</th>
                        <th>Floc</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data rows will be generated by JavaScript -->
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td>Total</td>
                        <td id="total-acid">0</td>
                        <td id="total-salt">0</td>
                        <td id="total-cal-plus">0</td>
                        <td id="total-cal-minus">0</td>
                        <td id="total-stabiliser">0</td>
                        <td id="total-phosphate">0</td>
                        <td id="total-powercide">0</td>
                        <td id="total-buffer">0</td>
                        <td id="total-chlorine">0</td>
                        <td id="total-floc">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="button-container">
            <button class="btn btn-reset" onclick="resetAll()">Reset Data</button>
            <button class="btn btn-export" onclick="exportToExcel()">Export to Excel</button>
        </div>
        
        <div class="instructions">
            <h3>Instructions</h3>
            <ul>
                <li>Click on data cells in the table to increase the value</li>
                <li>Increment rules and limits for each column:
                    <ul>
                        <li>Acid: +0.5 per click, max 4</li>
                        <li>Salt: +1 per click, max 10</li>
                        <li>Cal+: +2 per click, max 10</li>
                        <li>Cal-: +1 per click, max 5</li>
                        <li>Protec: +1 per click, max 4</li>
                        <li>Banish: +0.5 per click, max 4</li>
                        <li>Powercide: +0.5 per click, max 1</li>
                        <li>Buffer: +2 per click, max 10</li>
                        <li>Chlorine: +1 per click, max 10</li>
                        <li>Floc: +0.5 per click, max 1</li>
                    </ul>
                </li>
                <li>The "Total" row automatically calculates the sum of each column</li>
                <li>Use the "Reset Data" button to clear all inputs</li>
                <li>Use the "Export to Excel" button to export data to an Excel file</li>
            </ul>
        </div>
        
        <footer>
            <p>Â© 2023 Go Swim Chemical Work Record System</p>
        </footer>
    </div>

    <script>
        // Initialize table data
        const jobs = ['Job 1', 'Job 2', 'Job 3', 'Job 4', 'Job 5', 'Job 6', 'Job 7', 'Job 8', 'Job 9'];
        
        // Column configuration: id, name, step value, max value
        // Note: Buffer and Powercide positions are swapped
        const columns = [
            {id: 'acid', name: 'Acid', step: 0.5, max: 4},
            {id: 'salt', name: 'Salt', step: 1, max: 10},
            {id: 'cal-plus', name: 'Cal+', step: 2, max: 10},
            {id: 'cal-minus', name: 'Cal-', step: 1, max: 5},
            {id: 'stabiliser', name: 'Protec', step: 1, max: 4},
            {id: 'phosphate', name: 'Banish', step: 0.5, max: 4},
            {id: 'powercide', name: 'Powercide', step: 0.5, max: 1},
            {id: 'buffer', name: 'Buffer', step: 2, max: 10},
            {id: 'chlorine', name: 'Chlorine', step: 1, max: 10},
            {id: 'floc', name: 'Floc', step: 0.5, max: 1}
        ];
        
        let data = {};
        let currentDate = new Date().toISOString().split('T')[0]; // Default to today
        
        // Initialize data object
        function initializeData() {
            data = {};
            jobs.forEach(job => {
                data[job] = {};
                columns.forEach(col => {
                    data[job][col.id] = 0;
                });
            });
        }
        
        // Initialize date picker
        function initializeDatePicker() {
            const datePicker = document.getElementById('date-picker');
            
            // Set default value to today
            datePicker.value = currentDate;
            
            // Load saved date from local storage (if any)
            const savedDate = localStorage.getItem('chemicalTableDate');
            if (savedDate) {
                datePicker.value = savedDate;
                currentDate = savedDate;
            }
            
            // Add date change listener
            datePicker.addEventListener('change', function() {
                currentDate = this.value;
                localStorage.setItem('chemicalTableDate', currentDate);
                
                // Load data for this date (if exists)
                loadDataForDate();
            });
        }
        
        // Load data for specific date
        function loadDataForDate() {
            const savedData = localStorage.getItem(`chemicalTableData_${currentDate}`);
            if (savedData) {
                data = JSON.parse(savedData);
            } else {
                initializeData();
            }
            generateTable();
        }
        
        // Save data to local storage
        function saveData() {
            localStorage.setItem(`chemicalTableData_${currentDate}`, JSON.stringify(data));
        }
        
        // Generate table rows
        function generateTable() {
            const tbody = document.querySelector('#data-table tbody');
            tbody.innerHTML = '';
            
            jobs.forEach(job => {
                const row = document.createElement('tr');
                
                // Add job cell
                const jobCell = document.createElement('td');
                jobCell.textContent = job;
                row.appendChild(jobCell);
                
                // Add data cells
                columns.forEach(col => {
                    const cell = document.createElement('td');
                    const cellContent = document.createElement('div');
                    cellContent.className = 'clickable-cell';
                    cellContent.textContent = data[job][col.id] === 0 ? '' : data[job][col.id].toFixed(1);
                    cellContent.setAttribute('data-job', job);
                    cellContent.setAttribute('data-column', col.id);
                    
                    // Add special style if max is reached
                    if (data[job][col.id] >= col.max) {
                        cellContent.classList.add('cell-max');
                    }
                    
                    // Add click event
                    cellContent.addEventListener('click', (e) => {
                        incrementValue(job, col.id, cellContent);
                        e.stopPropagation();
                    });
                    
                    // Prevent text selection menu on long press on mobile devices
                    cellContent.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                    });
                    
                    cell.appendChild(cellContent);
                    row.appendChild(cell);
                });
                
                tbody.appendChild(row);
            });
            
            // Update totals
            updateTotals();
        }
        
        // Increment cell value
        function incrementValue(job, columnId, cell) {
            // Find column configuration
            const columnConfig = columns.find(col => col.id === columnId);
            if (!columnConfig) return;
            
            let currentValue = data[job][columnId];
            
            if (currentValue >= columnConfig.max) {
                // If current value has reached max, reset to 0
                data[job][columnId] = 0;
                cell.classList.remove('cell-max');
            } else {
                // Otherwise add step value
                data[job][columnId] += columnConfig.step;
                
                // Check if max is reached
                if (data[job][columnId] >= columnConfig.max) {
                    cell.classList.add('cell-max');
                }
            }
            
            // Update cell display
            cell.textContent = data[job][columnId] === 0 ? '' : data[job][columnId].toFixed(1);
            
            // Add animation effect
            cell.style.transform = 'scale(1.1)';
            cell.style.backgroundColor = '#a8d5ff';
            setTimeout(() => {
                cell.style.transform = '';
                cell.style.backgroundColor = '';
            }, 200);
            
            // Update totals
            updateTotals();
            
            // Save data
            saveData();
        }
        
        // Update total row
        function updateTotals() {
            columns.forEach(col => {
                let total = 0;
                jobs.forEach(job => {
                    total += data[job][col.id];
                });
                
                document.getElementById(`total-${col.id}`).textContent = total.toFixed(1);
            });
        }
        
        // Reset all data
        function resetAll() {
            if (confirm('Are you sure you want to reset all data for the current date?')) {
                initializeData();
                generateTable();
                saveData();
            }
        }
        
        // Export to Excel
        function exportToExcel() {
            // Create workbook
            const wb = XLSX.utils.book_new();
            
            // Prepare data
            const excelData = [
                ['Date', currentDate], // Add date row
                [], // Empty row
                ['Work Item', 'Acid', 'Salt', 'Cal+', 'Cal-', 'Protec', 'Banish', 'Powercide', 'Buffer', 'Chlorine', 'Floc']
            ];
            
            // Add job data
            jobs.forEach(job => {
                const row = [job];
                columns.forEach(col => {
                    row.push(data[job][col.id]);
                });
                excelData.push(row);
            });
            
            // Add total row
            const totalRow = ['Total'];
            columns.forEach(col => {
                let total = 0;
                jobs.forEach(job => {
                    total += data[job][col.id];
                });
                totalRow.push(total);
            });
            excelData.push(totalRow);
            
            // Create worksheet
            const ws = XLSX.utils.aoa_to_sheet(excelData);
            
            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, "Chemical Work Record");
            
            // Generate file name (with date)
            const fileName = `Go_Swim_Chemical_Work_Record_${currentDate}.xlsx`;
            
            // Export file
            XLSX.writeFile(wb, fileName);
        }
        
        // Initialize
        initializeDatePicker();
        initializeData();
        loadDataForDate();
        
        // Add touch event support
        document.addEventListener('touchstart', function() {}, false);
    </script>
</body>
</html>